<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Rspec on blog.10rane.com</title>
    <link>http://tatsuyano.github.io/tags/rspec/</link>
    <description>Recent content in Rspec on blog.10rane.com</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <lastBuildDate>Mon, 01 Sep 2014 01:00:00 +0900</lastBuildDate>
    <atom:link href="http://tatsuyano.github.io/tags/rspec/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>emacsのruby環境をセットアップする</title>
      <link>http://tatsuyano.github.io/2014/09/01/set-up-ruby-mode-of-emacs/</link>
      <pubDate>Mon, 01 Sep 2014 01:00:00 +0900</pubDate>
      
      <guid>http://tatsuyano.github.io/2014/09/01/set-up-ruby-mode-of-emacs/</guid>
      <description>

&lt;p&gt;最近&lt;code&gt;cask&lt;/code&gt;に切り替えたので、ruby環境も一から作り直したいと思います。
オムニ補完には、今までは&lt;code&gt;Rsense&lt;/code&gt;を使っていましたが、今回は&lt;code&gt;robe&lt;/code&gt;というパッケージと使ってみたいと思います。&lt;br /&gt;
&lt;em&gt;対象のEmacsのバージョンは24.3.1になります&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&#34;今回インストールするパッケージ:a38f072717c64d469504de0db33dd425&#34;&gt;今回インストールするパッケージ&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;ruby-mode&lt;/li&gt;
&lt;li&gt;ruby-end&lt;/li&gt;
&lt;li&gt;ruby-block&lt;/li&gt;
&lt;li&gt;inf-ruby&lt;/li&gt;
&lt;li&gt;robe&lt;/li&gt;
&lt;li&gt;auto-complete&lt;/li&gt;
&lt;li&gt;rvenv 　　　　　　# 2015/02/23追記&lt;/li&gt;
&lt;li&gt;smart-newline　# 2015/02/23追記&lt;/li&gt;
&lt;li&gt;rspec-mode 　　# 2015/02/23追記&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;ruby-mode-ruby-end-ruby-blockをインストール:a38f072717c64d469504de0db33dd425&#34;&gt;ruby-mode,ruby-end,ruby-blockをインストール&lt;/h3&gt;

&lt;p&gt;まずは基本的なところから。
Emacs24だと&lt;code&gt;ruby-electric&lt;/code&gt;がうまく動かなかったので、
今回はインストールしませんでしたが、&lt;code&gt;ruby-end&lt;/code&gt;だけで事足りました。&lt;/p&gt;

&lt;p&gt;~/.emacs/Cask&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;;; Ruby
(depends-on &amp;quot;ruby-mode&amp;quot;)
(depends-on &amp;quot;ruby-end&amp;quot;)
(depends-on &amp;quot;ruby-block&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;~/.emacs.d/init_loader/03_ruby.el&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;;; --------------------------------------------------
;; ruby-mode
;; http://shibayu36.hatenablog.com/entry/2013/03/18/192651
;; --------------------------------------------------
(autoload &#39;ruby-mode &amp;quot;ruby-mode&amp;quot;
  &amp;quot;Mode for editing ruby source files&amp;quot; t)
(add-to-list &#39;auto-mode-alist &#39;(&amp;quot;\\.rb$&amp;quot; . ruby-mode))
(add-to-list &#39;auto-mode-alist &#39;(&amp;quot;Capfile$&amp;quot; . ruby-mode))
(add-to-list &#39;auto-mode-alist &#39;(&amp;quot;Gemfile$&amp;quot; . ruby-mode))
(add-to-list &#39;interpreter-mode-alist &#39;(&amp;quot;ruby&amp;quot; . ruby-mode)) ;; shebangがrubyの場合、ruby-modeを開く

;; ruby-modeのインデントを改良する
(setq ruby-deep-indent-paren-style nil)
(defadvice ruby-indent-line (after unindent-closing-paren activate)
  (let ((column (current-column))
        indent offset)
    (save-excursion
      (back-to-indentation)
      (let ((state (syntax-ppss)))
        (setq offset (- column (current-column)))
        (when (and (eq (char-after) ?\))
                   (not (zerop (car state))))
          (goto-char (cadr state))
          (setq indent (current-indentation)))))
    (when indent
      (indent-line-to indent)
      (when (&amp;gt; offset 0) (forward-char offset)))))

;; --------------------------------------------------
;; ruby-end
;; endや括弧などを自動挿入する
;; http://blog.livedoor.jp/ooboofo3/archives/53748087.html
;; --------------------------------------------------
(require &#39;ruby-end)
(add-hook &#39;ruby-mode-hook
  &#39;(lambda ()
    (abbrev-mode 1)
    (electric-pair-mode t)
    (electric-indent-mode t)
    (electric-layout-mode t)))

;; --------------------------------------------------
;; ruby-block
;; endにカーソルを合わせると、そのendに対応する行をハイライトする
;; --------------------------------------------------
(require &#39;ruby-block)
(ruby-block-mode t)
(setq ruby-block-highlight-toggle t)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;auto-completeのインストール:a38f072717c64d469504de0db33dd425&#34;&gt;auto-completeのインストール&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;cask&lt;/code&gt;でインストールすると、辞書が格納されるディレクトリ(dict)のパスが
&lt;code&gt;~/.emacs.d/.cask/24.3.1/elpa/auto-complete-20140824.1658/dict&amp;quot;&lt;/code&gt;になりました。&lt;/p&gt;

&lt;p&gt;~/.emacs/Cask&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;;; Auto-complete
(depends-on &amp;quot;auto-complete&amp;quot;)
(depends-on &amp;quot;fuzzy&amp;quot;)
(depends-on &amp;quot;popup&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;~/.emacs.d/init_loader/02_auto-complete.el&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;(require &#39;auto-complete-config)
(add-to-list &#39;ac-dictionary-directories &amp;quot;~/.emacs.d/.cask/24.3.1/elpa/auto-complete-20140824.1658/dict&amp;quot;)
(ac-config-default)
(setq ac-use-menu-map t)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;robeのインストール:a38f072717c64d469504de0db33dd425&#34;&gt;robeのインストール&lt;/h3&gt;

&lt;p&gt;ここからが本題のrobeのインストールです。
&lt;code&gt;robe&lt;/code&gt;を使うには、&lt;code&gt;pry&lt;/code&gt;という&lt;code&gt;Gem&lt;/code&gt;が必要になりますが、
&lt;code&gt;pry&lt;/code&gt;を使うためには、&lt;code&gt;read-line&lt;/code&gt;ライブラリをインストール時にオプション指定したRubyが必要になります。&lt;/p&gt;

&lt;p&gt;今回すでに、&lt;code&gt;read-line&lt;/code&gt;が入っていない状態でRubyをインストールしていたので、
再度インストールし直したいと思います。&lt;/p&gt;

&lt;h4 id=&#34;pryのインストール:a38f072717c64d469504de0db33dd425&#34;&gt;pryのインストール&lt;/h4&gt;

&lt;pre&gt;&lt;code&gt;$ gem install pry
$ source $HOME/.zshrc

$ which pry
$HOME/.anyenv/envs/rbenv/shims/pry
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;read-line&lt;/code&gt;ライブラリを読み込めないため、&lt;code&gt;pry&lt;/code&gt;が実行できない&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; $ pry
 Sorry, you can&#39;t use Pry without Readline or a compatible library.
 Possible solutions:
  * Rebuild Ruby with Readline support using `--with-readline`
  * Use the rb-readline gem, which is a pure-Ruby port of Readline
  * Use the pry-coolline gem, a pure-ruby alternative to Readline
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://qiita.com/Tamadon/items/347baf2ba89ccde89624&#34;&gt;Pry起動時にエラーが出る場合の対処法&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://labs.timedia.co.jp/2011/12/rubyist-should-use-pry.html&#34;&gt;Rubyistよ、irbを捨ててPryを使おう&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;readlineのインストールとrubyの再インストール:a38f072717c64d469504de0db33dd425&#34;&gt;readlineのインストールとRubyの再インストール&lt;/h4&gt;

&lt;pre&gt;&lt;code&gt;$ sudo yum -y install readline-devel
$ rbenv uninstall 2.1.0
$ rbenv install 2.1.0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;注意&lt;/em&gt;&lt;br /&gt;
Ruby本体の再インストールをしたため、&lt;code&gt;pry&lt;/code&gt;や&lt;code&gt;bundle&lt;/code&gt;なども削除されていますので、
再度インストールしてください。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ gem install pry pry-doc bundler
$ source $HOME/.zshrc
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;emacsの設定:a38f072717c64d469504de0db33dd425&#34;&gt;emacsの設定&lt;/h4&gt;

&lt;p&gt;&lt;code&gt;robe&lt;/code&gt;は内部で&lt;code&gt;inf-ruby&lt;/code&gt;を使っているので、&lt;code&gt;robe&lt;/code&gt;をインストールすると、
&lt;code&gt;inf-ruby&lt;/code&gt;も自動でインストールされます。&lt;/p&gt;

&lt;p&gt;~/.emacs/Cask&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;(depends-on &amp;quot;robe&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;~/.emacs.d/init_loader/03_ruby.el&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;;; --------------------------------------------------
;; robe
;; http://codeout.hatenablog.com/entry/2014/02/04/210237
;; --------------------------------------------------
(add-hook &#39;ruby-mode-hook &#39;robe-mode)
(autoload &#39;robe-mode &amp;quot;robe&amp;quot; &amp;quot;Code navigation, documentation lookup and completion for Ruby&amp;quot; t nil)
(autoload &#39;ac-robe-setup &amp;quot;ac-robe&amp;quot; &amp;quot;auto-complete robe&amp;quot; nil nil)
(add-hook &#39;robe-mode-hook &#39;ac-robe-setup)
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;robeの起動方法:a38f072717c64d469504de0db33dd425&#34;&gt;robeの起動方法&lt;/h4&gt;

&lt;p&gt;&lt;code&gt;robe&lt;/code&gt;を利用するには、&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;M-x inf-ruby&lt;/code&gt;を実行し、裏で&lt;code&gt;irb(pry)&lt;/code&gt;を起動させ、&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M-x robe-start&lt;/code&gt;で初めて&lt;code&gt;robe&lt;/code&gt;が使えるようになります。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&#34;https://dl.dropboxusercontent.com/u/159938/blog_images/set-up-ruby-mode-of-emacs_01.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;h4 id=&#34;gemfileを用意してirb-pry-を裏で自動に起動させる:a38f072717c64d469504de0db33dd425&#34;&gt;Gemfileを用意してirb(pry)を裏で自動に起動させる&lt;/h4&gt;

&lt;p&gt;編集したいファイルと同じディレクトリに&lt;code&gt;pry&lt;/code&gt;のための&lt;code&gt;Gemfile&lt;/code&gt;を用意しておけば、
&lt;code&gt;M-x robe-start&lt;/code&gt;だけで&lt;code&gt;robe&lt;/code&gt;をつかうことができます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ bundle init
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Gemfile&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;source &amp;quot;https://rubygems.org&amp;quot;

gem &amp;quot;pry&amp;quot;
gem &amp;quot;pry-doc&amp;quot;,       &amp;quot;&amp;gt;= 0.6.0&amp;quot;
gem &amp;quot;method_source&amp;quot;, &amp;quot;&amp;gt;= 0.8.2&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/dgutov/robe#dependencies&#34;&gt;robe:Dependencies&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;rbenvのパスを通す:a38f072717c64d469504de0db33dd425&#34;&gt;rbenvのパスを通す&lt;/h3&gt;

&lt;p&gt;&lt;em&gt;2015/02/23 追記&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Emacsにrbenvのパスを通してくれます。&lt;/p&gt;

&lt;p&gt;~/.emacs.d/initloader/03_ruby.el
&lt;pre&gt;&lt;code class=&#39;language-ruby&#39;&gt; (require &amp;lsquo;rbenv)
 (global-rbenv-mode)
 (setq rbenv-installation-dir &amp;ldquo;~/.anyenv/envs/rbenv&amp;rdquo;)
&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://block-given.hatenablog.com/entry/2014/11/12/005657&#34;&gt;モダンなEmacsを求めて (6) Rubyについて&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;smart-newlineを導入する:a38f072717c64d469504de0db33dd425&#34;&gt;smart-newlineを導入する&lt;/h3&gt;

&lt;p&gt;&lt;em&gt;2015/02/23 追記&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;改行をよしなにやってくれます。素敵です。&lt;/p&gt;

&lt;p&gt;~/.emacs.d/initloader/03_ruby.el
&lt;pre&gt;&lt;code class=&#39;language-ruby&#39;&gt; (add-hook &amp;lsquo;ruby-mode-hook
   (lambda ()
   (smart-newline-mode t)))
&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://ainame.hateblo.jp/entry/2013/12/08/162032&#34;&gt;smart-newline.elという拡張&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;rspec-modeを導入する:a38f072717c64d469504de0db33dd425&#34;&gt;rspec-modeを導入する&lt;/h3&gt;

&lt;p&gt;&lt;em&gt;2015/02/23 追記&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;テストとその対象のコードを簡単に切り替えてくれたり、カーソルのある行だけのテストを実行してくれる。
キーバインドにカンマが入っていることに注意。&lt;/p&gt;

&lt;p&gt;~/.emacs.d/initloader/03ruby.el
&lt;pre&gt;&lt;code class=&#39;language-ruby&#39;&gt; ;; C-c , v RSpec実行
 ;; C-c , s カ-ソルが当たっているサンプルを実行
 ;; C-c , t Specとソースを切り替える
 (require &amp;lsquo;rspec-mode)
 (custom-set-variables &amp;lsquo;(rspec-use-rake-flag nil))
&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://futurismo.biz/archives/2266&#34;&gt;EmacsでRSpec環境をめちゃガチャパワーアップしたまとめ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;お疲れ様でした。&lt;/p&gt;

&lt;h3 id=&#34;参考サイト:a38f072717c64d469504de0db33dd425&#34;&gt;参考サイト&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://shibayu36.hatenablog.com/entry/2013/03/18/192651&#34;&gt;emacsのruby環境を整えています&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.livedoor.jp/ooboofo3/archives/53748087.html&#34;&gt;Emacs24 で ruby-electric的なruby-modeを実現するには&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://codeout.hatenablog.com/entry/2014/02/04/210237&#34;&gt;auto-complete + rsense の代わりに auto-complete + robe をつかう&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://qiita.com/Tamadon/items/347baf2ba89ccde89624&#34;&gt;Pry起動時にエラーが出る場合の対処法&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://labs.timedia.co.jp/2011/12/rubyist-should-use-pry.html&#34;&gt;Rubyistよ、irbを捨ててPryを使おう&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/dgutov/robe#dependencies&#34;&gt;robe:Dependencies&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;関連する記事:a38f072717c64d469504de0db33dd425&#34;&gt;関連する記事&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.10rane.com/2014/08/19/install-anyenv/&#34;&gt;anyenvをインストールする&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://blog.10rane.com/2014/08/28/how-to-install-and-setup-initloader-in-cask/&#34;&gt;init-loaderをCaskでインストールする&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>