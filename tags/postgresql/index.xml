<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Postgresql on blog.10rane.com</title>
    <link>http://tatsuyano.github.io/tags/postgresql/</link>
    <description>Recent content in Postgresql on blog.10rane.com</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <lastBuildDate>Mon, 09 Mar 2015 01:00:00 +0900</lastBuildDate>
    <atom:link href="http://tatsuyano.github.io/tags/postgresql/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>RailsでPostgreSQLを使う</title>
      <link>http://tatsuyano.github.io/2015/03/09/i-use-postgresql-with-rails/</link>
      <pubDate>Mon, 09 Mar 2015 01:00:00 +0900</pubDate>
      
      <guid>http://tatsuyano.github.io/2015/03/09/i-use-postgresql-with-rails/</guid>
      <description>

&lt;p&gt;アプリをHerokuにdeployしたらSQLエラーが出てしまったので、
ローカルでの開発もPostgreSQLを使ってみようと思います。&lt;/p&gt;

&lt;h2 id=&#34;postgresqlのインストール:75b64ddf54d76b23d517b111450a597c&#34;&gt;PostgreSQLのインストール&lt;/h2&gt;

&lt;p&gt;ちなみにインストール先のOSはamazon-linuxです。
&lt;pre&gt;&lt;code class=&#39;language-bash&#39;&gt;$ sudo yum -y install postgresql93
$ sudo yum -y install postgresql93-devel
$ sudo yum -y install postgresql93-server&lt;/p&gt;

&lt;p&gt;$ psql &amp;ndash;version
psql (PostgreSQL) 9.3.6&lt;/p&gt;

&lt;h1 id=&#34;データベースの初期化:75b64ddf54d76b23d517b111450a597c&#34;&gt;データベースの初期化&lt;/h1&gt;

&lt;p&gt;$ sudo /etc/init.d/postgresql93 initdb&lt;/p&gt;

&lt;h1 id=&#34;データベースの起動:75b64ddf54d76b23d517b111450a597c&#34;&gt;データベースの起動&lt;/h1&gt;

&lt;p&gt;$ sudo /etc/init.d/postgresql93 start&lt;/p&gt;

&lt;h1 id=&#34;サーバー起動時にpostgresの起動設定:75b64ddf54d76b23d517b111450a597c&#34;&gt;サーバー起動時にpostgresの起動設定&lt;/h1&gt;

&lt;p&gt;$ sudo chkconfig postgresql93 on
&lt;/code&gt;&lt;/pre&gt;
&lt;br&gt;&lt;/p&gt;

&lt;h3 id=&#34;postgresqlアカウントの設定:75b64ddf54d76b23d517b111450a597c&#34;&gt;PostgreSQLアカウントの設定&lt;/h3&gt;

&lt;p&gt;まずは PostgreSQL にスーパーユーザ(postgres)で接続し、パスワードを設定します。
&lt;pre&gt;&lt;code class=&#39;language-bash&#39;&gt;$ sudo -u postgres psql
postgres=# alter role postgres with password &amp;lsquo;hogehoge&amp;rsquo;;  # alter role [user_name] with password &amp;lsquo;[password]&amp;lsquo;;
&lt;/code&gt;&lt;/pre&gt;
&lt;br&gt;&lt;/p&gt;

&lt;h3 id=&#34;データベースの作成:75b64ddf54d76b23d517b111450a597c&#34;&gt;データベースの作成&lt;/h3&gt;

&lt;p&gt;わかりやすいようにデータベース名とRailsのアプリ名(myapp)を同じにします。
ついでにテスト(RSpec)用のデータベースも作成しておきます。
&lt;pre&gt;&lt;code class=&#39;language-ruby&#39;&gt;postgres=# create database myapp owner postgres; # create database [database_name] owner [user_name];
postgres=# create database myapp_test owner postgres;
&lt;/code&gt;&lt;/pre&gt;
&lt;br&gt;&lt;/p&gt;

&lt;h3 id=&#34;アクセス権限の設定:75b64ddf54d76b23d517b111450a597c&#34;&gt;アクセス権限の設定&lt;/h3&gt;

&lt;p&gt;Rails から PostgreSQL に接続するために、&lt;code&gt;pg_hba.conf&lt;/code&gt;の設定を変更します。&lt;/p&gt;

&lt;p&gt;/var/lib/pgsql93/data/pg_hba.conf
&lt;pre&gt;&lt;code class=&#39;language-bash&#39;&gt;# TYPE  DATABASE  USER  ADDRESS   METHOD
#local   all       all             peer  &amp;lt;= コメントアウト
local   all       all             md5   &amp;lt;= コメントイン
&lt;/code&gt;&lt;/pre&gt;
変更後は、PostreSQL と Nginx を再起動
&lt;pre&gt;&lt;code class=&#39;language-bash&#39;&gt;$ sudo /etc/init.d/postgresql93 restart
$ sudo /etc/init.d/nginx restart
&lt;/code&gt;&lt;/pre&gt;
&lt;br&gt;&lt;/p&gt;

&lt;h2 id=&#34;rails側の設定:75b64ddf54d76b23d517b111450a597c&#34;&gt;Rails側の設定&lt;/h2&gt;

&lt;p&gt;アプリを作成する前に、PostgreSQL を初めて使う場合は、先に&lt;code&gt;pg gem&lt;/code&gt;をインストールしておきます。
&lt;pre&gt;&lt;code class=&#39;language-bash&#39;&gt;$ gem install pg
&lt;/code&gt;&lt;/pre&gt;
&lt;br&gt;&lt;/p&gt;

&lt;h3 id=&#34;アプリの作成:75b64ddf54d76b23d517b111450a597c&#34;&gt;アプリの作成&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;-d&lt;/code&gt;パラメータでDBでPostgreSQLに指定する&lt;/p&gt;

&lt;p&gt;&lt;pre&gt;&lt;code class=&#39;language-bash&#39;&gt;$ rails new myapp -T -d postgresql
&lt;/code&gt;&lt;/pre&gt;
&lt;br&gt;&lt;/p&gt;

&lt;h3 id=&#34;接続先情報の設定:75b64ddf54d76b23d517b111450a597c&#34;&gt;接続先情報の設定&lt;/h3&gt;

&lt;p&gt;先ほど作成したデータベースとアカウントの情報を設定します。&lt;/p&gt;

&lt;p&gt;config/database.yml
&lt;pre&gt;&lt;code class=&#39;language-ruby&#39;&gt; default: &amp;amp;default
   adapter: postgresql
   encoding: unicode
   pool: 5&lt;/p&gt;

&lt;p&gt;development:
   &amp;lt;&amp;lt;: *default
   database: myapp
   username: postgres
   password: hogehoge&lt;/p&gt;

&lt;p&gt;test:
   &amp;lt;&amp;lt;: *default
   database: myapp_test
   username: postgres
   password: hogehoge
&lt;/code&gt;&lt;/pre&gt;
&lt;br&gt;&lt;/p&gt;

&lt;p&gt;###(おまけ) PostgeSQLのコマンド&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;データベース一覧を取得する &amp;hellip; \l&lt;/li&gt;
&lt;li&gt;データベースを選択する     &amp;hellip; \c [データベース名]&lt;/li&gt;
&lt;li&gt;テーブル一覧を取得する     &amp;hellip; \z&lt;/li&gt;
&lt;li&gt;テーブルスキーマを取得する &amp;hellip; \d [テーブル名]&lt;/li&gt;
&lt;li&gt;ユーザ(Role)の一覧         &amp;hellip; \du&lt;/li&gt;
&lt;li&gt;パスワードの変更           &amp;hellip; alter role [ロール名] with password &amp;lsquo;[新しいパスワード]&amp;lsquo;;&lt;/li&gt;
&lt;li&gt;データベースの作成         &amp;hellip; create database [データベース名] owner [ロール名];&lt;/li&gt;
&lt;li&gt;データベースの削除         &amp;hellip; drop database [データベース名];&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;参考サイト:75b64ddf54d76b23d517b111450a597c&#34;&gt;参考サイト&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.workabroad.jp/posts/1079&#34;&gt;RubyonRailsでsqliteでなくてPostgresqlを使う時&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>